<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PiggyBank - New Transaction</title>
  <link rel="stylesheet" href="../shared/design-system.css">
  <style>
    body {
      min-height: 100vh;
    }

    .page-container {
      max-width: 600px;
      margin: 0 auto;
      padding: var(--space-8) var(--space-4);
    }

    .page-header {
      margin-bottom: var(--space-8);
    }

    .back-button {
      display: inline-flex;
      align-items: center;
      gap: var(--space-2);
      color: var(--parent-primary);
      text-decoration: none;
      font-weight: var(--font-medium);
      margin-bottom: var(--space-4);
    }

    .back-button:hover {
      text-decoration: underline;
    }

    .page-title {
      font-size: var(--text-3xl);
      margin-bottom: var(--space-2);
    }

    .page-subtitle {
      color: var(--parent-text-secondary);
    }

    .form-card {
      background-color: var(--white);
      border-radius: var(--radius-xl);
      padding: var(--space-8);
      box-shadow: var(--shadow-xl);
    }

    /* Child Summary */
    .child-summary {
      background-color: var(--parent-bg-secondary);
      border-radius: var(--radius-lg);
      padding: var(--space-4);
      margin-bottom: var(--space-6);
      display: flex;
      align-items: center;
      gap: var(--space-4);
    }

    .child-summary-avatar {
      width: 56px;
      height: 56px;
      border-radius: var(--radius-full);
      background: linear-gradient(135deg, var(--parent-primary-light) 0%, var(--parent-primary) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: var(--text-3xl);
    }

    .child-summary-info {
      flex: 1;
    }

    .child-summary-name {
      font-weight: var(--font-semibold);
      margin-bottom: var(--space-1);
    }

    .child-summary-balance {
      color: var(--parent-text-secondary);
      font-size: var(--text-sm);
    }

    .current-balance {
      font-weight: var(--font-bold);
      color: var(--parent-success);
    }

    /* Transaction Type Toggle */
    .transaction-type-toggle {
      display: flex;
      gap: var(--space-3);
      margin-bottom: var(--space-6);
    }

    .type-option {
      flex: 1;
      padding: var(--space-4);
      border-radius: var(--radius-lg);
      border: 2px solid var(--parent-border);
      background-color: var(--white);
      cursor: pointer;
      text-align: center;
      transition: all var(--transition-base);
    }

    .type-option:hover {
      border-color: var(--parent-primary);
      transform: translateY(-2px);
    }

    .type-option.active {
      border-width: 3px;
      font-weight: var(--font-bold);
    }

    .type-option.deposit.active {
      border-color: var(--parent-success);
      background-color: var(--parent-success-light);
    }

    .type-option.deduction.active {
      border-color: var(--parent-danger);
      background-color: var(--parent-danger-light);
    }

    .type-icon {
      font-size: var(--text-3xl);
      margin-bottom: var(--space-2);
    }

    .type-label {
      font-size: var(--text-lg);
      margin-bottom: var(--space-1);
    }

    .type-description {
      font-size: var(--text-sm);
      color: var(--parent-text-secondary);
    }

    /* Amount Input */
    .amount-input-wrapper {
      position: relative;
      margin-bottom: var(--space-4);
    }

    .amount-input {
      width: 100%;
      padding: var(--space-4) var(--space-4) var(--space-4) var(--space-12);
      font-size: var(--text-3xl);
      font-weight: var(--font-bold);
      border: 3px solid var(--parent-border);
      border-radius: var(--radius-lg);
      text-align: left;
    }

    .amount-input:focus {
      border-color: var(--parent-primary);
    }

    .currency-symbol {
      position: absolute;
      left: var(--space-4);
      top: 50%;
      transform: translateY(-50%);
      font-size: var(--text-3xl);
      font-weight: var(--font-bold);
      color: var(--parent-text-secondary);
    }

    /* Quick Amount Buttons */
    .quick-amounts {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: var(--space-2);
      margin-bottom: var(--space-6);
    }

    .quick-amount {
      padding: var(--space-2);
      border-radius: var(--radius-md);
      background-color: var(--parent-bg-secondary);
      border: 2px solid var(--parent-border);
      cursor: pointer;
      font-weight: var(--font-medium);
      transition: all var(--transition-base);
    }

    .quick-amount:hover {
      background-color: var(--parent-primary-light);
      border-color: var(--parent-primary);
      transform: translateY(-2px);
    }

    /* New Balance Preview */
    .balance-preview {
      background-color: var(--parent-primary-light);
      border: 2px solid var(--parent-primary);
      border-radius: var(--radius-lg);
      padding: var(--space-4);
      margin-bottom: var(--space-6);
      text-align: center;
    }

    .balance-preview-label {
      font-size: var(--text-sm);
      color: var(--parent-text-secondary);
      margin-bottom: var(--space-2);
    }

    .balance-preview-amount {
      font-size: var(--text-2xl);
      font-weight: var(--font-bold);
      color: var(--parent-success);
    }

    .balance-change {
      font-size: var(--text-lg);
      margin-top: var(--space-2);
    }

    .balance-change.positive {
      color: var(--parent-success);
    }

    .balance-change.negative {
      color: var(--parent-danger);
    }

    .form-actions {
      display: flex;
      gap: var(--space-4);
    }

    @media (max-width: 640px) {
      .quick-amounts {
        grid-template-columns: repeat(3, 1fr);
      }

      .form-actions {
        flex-direction: column;
      }

      .form-actions .btn {
        width: 100%;
      }
    }
  </style>
</head>
<body class="parent-theme">
  <div class="page-container">
    <!-- Page Header -->
    <div class="page-header">
      <a href="03-parent-dashboard.html" class="back-button">
        ‚Üê Back to Dashboard
      </a>
      <h1 class="page-title">New Transaction</h1>
      <p class="page-subtitle">Add or deduct money from piggy bank</p>
    </div>

    <!-- Form -->
    <div class="form-card">
      <!-- Child Summary -->
      <div class="child-summary">
        <div class="child-summary-avatar">ü¶Ñ</div>
        <div class="child-summary-info">
          <div class="child-summary-name">Emma</div>
          <div class="child-summary-balance">
            Current Balance: <span class="current-balance">$125.50</span>
          </div>
        </div>
      </div>

      <form id="transaction-form">
        <!-- Transaction Type Toggle -->
        <div class="transaction-type-toggle">
          <div class="type-option deposit active" onclick="selectType('deposit')">
            <div class="type-icon">üí∞</div>
            <div class="type-label">Deposit</div>
            <div class="type-description">Add money</div>
          </div>
          <div class="type-option deduction" onclick="selectType('deduction')">
            <div class="type-icon">üì§</div>
            <div class="type-label">Deduction</div>
            <div class="type-description">Remove money</div>
          </div>
        </div>
        <input type="hidden" id="transaction-type" name="type" value="deposit" />

        <!-- Amount -->
        <div class="form-group">
          <label for="amount" class="form-label">Amount</label>
          <div class="amount-input-wrapper">
            <span class="currency-symbol">$</span>
            <input
              type="number"
              id="amount"
              name="amount"
              class="amount-input"
              placeholder="0.00"
              min="0.01"
              max="1000.00"
              step="0.01"
              required
              oninput="updateBalancePreview()"
            />
          </div>

          <!-- Quick Amount Buttons -->
          <div class="quick-amounts">
            <button type="button" class="quick-amount" onclick="setAmount(5)">$5</button>
            <button type="button" class="quick-amount" onclick="setAmount(10)">$10</button>
            <button type="button" class="quick-amount" onclick="setAmount(20)">$20</button>
            <button type="button" class="quick-amount" onclick="setAmount(50)">$50</button>
          </div>

          <div class="form-help">
            Amount must be between $0.01 and $1,000.00
          </div>
        </div>

        <!-- Balance Preview -->
        <div class="balance-preview" id="balance-preview" style="display: none;">
          <div class="balance-preview-label">New Balance</div>
          <div class="balance-preview-amount" id="new-balance">$125.50</div>
          <div class="balance-change" id="balance-change"></div>
        </div>

        <!-- Reason -->
        <div class="form-group">
          <label for="reason" class="form-label">Reason</label>
          <textarea
            id="reason"
            name="reason"
            class="form-textarea"
            placeholder="e.g., Weekly allowance, Completed chores, Toy purchase..."
            required
            maxlength="500"
            rows="3"
          ></textarea>
          <div class="form-help">
            Explain what this transaction is for (required)
          </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" onclick="window.location.href='03-parent-dashboard.html'">
            Cancel
          </button>
          <button type="submit" class="btn btn-primary" id="submit-btn" style="flex: 2;">
            Add Deposit
          </button>
        </div>
      </form>
    </div>
  </div>

  <script>
    const currentBalance = 125.50;
    let selectedType = 'deposit';

    function selectType(type) {
      selectedType = type;
      document.getElementById('transaction-type').value = type;

      // Update UI
      document.querySelectorAll('.type-option').forEach(opt => opt.classList.remove('active'));
      document.querySelector(`.type-option.${type}`).classList.add('active');

      // Update button text
      const submitBtn = document.getElementById('submit-btn');
      if (type === 'deposit') {
        submitBtn.textContent = 'Add Deposit';
        submitBtn.className = 'btn btn-success';
      } else {
        submitBtn.textContent = 'Make Deduction';
        submitBtn.className = 'btn btn-danger';
      }

      updateBalancePreview();
    }

    function setAmount(value) {
      document.getElementById('amount').value = value.toFixed(2);
      updateBalancePreview();
    }

    function updateBalancePreview() {
      const amountInput = document.getElementById('amount');
      const amount = parseFloat(amountInput.value) || 0;

      if (amount > 0) {
        const preview = document.getElementById('balance-preview');
        const newBalanceEl = document.getElementById('new-balance');
        const changeEl = document.getElementById('balance-change');

        let newBalance;
        if (selectedType === 'deposit') {
          newBalance = currentBalance + amount;
          changeEl.textContent = `+$${amount.toFixed(2)}`;
          changeEl.className = 'balance-change positive';
        } else {
          newBalance = currentBalance - amount;
          changeEl.textContent = `-$${amount.toFixed(2)}`;
          changeEl.className = 'balance-change negative';
        }

        newBalanceEl.textContent = `$${newBalance.toFixed(2)}`;
        preview.style.display = 'block';

        // Check for negative balance
        if (newBalance < 0) {
          newBalanceEl.style.color = 'var(--parent-danger)';
        } else {
          newBalanceEl.style.color = 'var(--parent-success)';
        }
      } else {
        document.getElementById('balance-preview').style.display = 'none';
      }
    }

    // Form Submission
    document.getElementById('transaction-form').addEventListener('submit', function(e) {
      e.preventDefault();

      const amount = parseFloat(document.getElementById('amount').value);
      const reason = document.getElementById('reason').value;
      const type = selectedType;

      // Validation
      if (!amount || amount < 0.01 || amount > 1000) {
        alert('Amount must be between $0.01 and $1,000.00');
        return;
      }

      if (!reason || reason.trim().length === 0) {
        alert('Please provide a reason for this transaction.');
        return;
      }

      // Check for negative balance on deduction
      if (type === 'deduction' && amount > currentBalance) {
        alert(`Cannot deduct $${amount.toFixed(2)}.\n\nEmma's current balance is $${currentBalance.toFixed(2)}.\nPlease enter a smaller amount or add a deposit first.`);
        return;
      }

      // Success
      const newBalance = type === 'deposit' ? currentBalance + amount : currentBalance - amount;
      const typeText = type === 'deposit' ? 'Deposit' : 'Deduction';
      alert(`‚úì ${typeText} successful!\n\nAmount: $${amount.toFixed(2)}\nReason: ${reason}\nNew Balance: $${newBalance.toFixed(2)}`);
      window.location.href = '03-parent-dashboard.html';
    });

    // Initialize
    updateBalancePreview();
  </script>
</body>
</html>
